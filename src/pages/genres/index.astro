---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import Main from "@/layouts/Main.astro";
import getUniqueGenres from "@/utils/getUniqueGenres";
import getReviewsByGenre from "@/utils/getReviewsByGenre";
import { SITE } from "@/config";

const allReviews = await getCollection("reviews");
const genres = getUniqueGenres(allReviews);

// Count reviews per genre
const genresWithCounts = genres.map(({ genre, genreName }) => ({
  genre,
  genreName,
  count: getReviewsByGenre(allReviews, genre).length,
}));
---

<Layout title={`Genres | ${SITE.title}`}>
  <Header />
  <Main pageTitle="Genres" pageDesc="Browse reviews by genre.">
    <ul class="grid grid-cols-2 gap-3 sm:grid-cols-3">
      {
        genresWithCounts.map(({ genre, genreName, count }) => (
          <li>
            <a
              href={`/genres/${genre}/`}
              class="group flex flex-col gap-1 border border-border p-4 transition-all hover:border-accent hover:border-l-4 hover:-translate-y-0.5"
            >
              <span class="font-display text-sm font-bold uppercase tracking-widest group-hover:text-accent transition-colors">
                {genreName}
              </span>
              <span class="font-mono text-xs text-foreground/50">
                {count} {count === 1 ? "review" : "reviews"}
              </span>
            </a>
          </li>
        ))
      }
    </ul>
  </Main>
  <Footer />
</Layout>
